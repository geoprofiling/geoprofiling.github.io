<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Where Do Images Come From? Analyzing Captions to Geographically Profile Vision-Language Datasets</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            background: #ffffff;
            color: #333;
            line-height: 1.6;
            padding: 40px 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2.2em;
            font-weight: 700;
            text-align: center;
            margin-bottom: 30px;
            color: #222;
            line-height: 1.2;
        }

        .authors {
            text-align: center;
            margin-bottom: 30px;
            color: #666;
            font-size: 1em;
        }

        .button-container {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 50px;
        }

        .button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            font-size: 1em;
            font-weight: 500;
            text-decoration: none;
            border-radius: 12px;
            transition: all 0.2s ease;
            border: 1.5px solid #333;
            color: #333;
            background: #fff;
            cursor: pointer;
        }

        .button svg {
            width: 18px;
            height: 18px;
            fill: currentColor;
        }

        .button:hover {
            background: #333;
            color: #fff;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .button-arxiv {
            border-color: #b31b1b;
            color: #b31b1b;
        }

        .button-arxiv:hover {
            background: #b31b1b;
            color: #fff;
            border-color: #b31b1b;
        }

        .button-code {
            border-color: #333;
            color: #333;
        }

        .button-code:hover {
            background: #333;
            color: #fff;
            border-color: #333;
        }

        .button-samples {
            border-color: #0066cc;
            color: #0066cc;
        }

        .button-samples:hover {
            background: #0066cc;
            color: #fff;
            border-color: #0066cc;
        }

        .content {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px 0;
            text-align: center;
        }

        .content p {
            margin-bottom: 30px;
            color: #444;
            line-height: 1.8;
            font-size: 1.05em;
        }

        .dropdown-container {
            margin: 30px auto;
            max-width: 400px;
        }

        .dropdown-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: #333;
            font-size: 1em;
        }

        .entity-dropdown {
            width: 100%;
            padding: 12px 16px;
            font-size: 1em;
            font-family: inherit;
            border: 1.5px solid #333;
            border-radius: 8px;
            background: #fff;
            color: #333;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .entity-dropdown:hover {
            border-color: #0066cc;
        }

        .entity-dropdown:focus {
            outline: none;
            border-color: #0066cc;
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
        }

        .country-dropdown-container {
            margin: 30px auto;
            max-width: 400px;
            display: none;
        }

        .country-dropdown-container.show {
            display: block;
        }

        .image-gallery-container {
            margin: 40px auto;
            max-width: 1200px;
            display: none;
        }

        .image-gallery-container.show {
            display: block;
        }

        .image-gallery {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .image-item {
            position: relative;
            width: 100%;
            padding-top: 100%; /* Square aspect ratio */
            overflow: hidden;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            background: #f5f5f5;
        }

        .image-item img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .image-item img:hover {
            transform: scale(1.05);
        }

        .gallery-title {
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #222;
            text-align: center;
        }

        .loading-message {
            text-align: center;
            color: #666;
            margin: 20px 0;
        }

        .back-button-container {
            text-align: center;
            margin: 30px 0;
        }

        .button-back {
            border-color: #666;
            color: #666;
        }

        .button-back:hover {
            background: #666;
            color: #fff;
            border-color: #666;
        }

        @media (max-width: 1200px) {
            .image-gallery {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 900px) {
            .image-gallery {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.6em;
            }

            .button {
                width: 100%;
                max-width: 200px;
            }

            body {
                padding: 20px 10px;
            }

            .image-gallery {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
        }

        @media (max-width: 480px) {
            .image-gallery {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Where Do Images Come From? Analyzing Captions to Geographically Profile Vision-Language Datasets</h1>
        
        <div class="authors">
            Abhipsa Basu, Yugam Bahl, Kirti Bhagat, Preethi Seshadri, R. Venkatesh Babu, Danish Pruthi
        </div>
        
        <div class="button-container">
            <a href="https://arxiv.org/pdf/2602.09775" class="button button-arxiv">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="18" height="18">
                    <text x="12" y="18" font-family="serif" font-size="16" font-weight="bold" text-anchor="middle" fill="currentColor">Ξ</text>
                </svg>
                arXiv
            </a>
            <a href="https://github.com/abhipsabasu/Extract-Retrieve-Predict" class="button button-code">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
                Code
            </a>
            <a href="samples.html" class="button button-samples">Geo-Profiled Samples</a>
        </div>

        <div class="content">
            <div class="back-button-container">
                <a href="index.html" class="button button-back">← Back to Project Page</a>
            </div>
            
            <p>Here you can view the images from different entities and countries. To begin, select the entity of your choice.</p>
            
            <div class="dropdown-container">
                <label for="entity-select" class="dropdown-label">Select Entity:</label>
                <select id="entity-select" class="entity-dropdown">
                    <option value="">-- Select an entity --</option>
                    <option value="mountain">Mountain</option>
                    <option value="hill">Hill</option>
                    <option value="lake">Lake</option>
                    <option value="valley">Valley</option>
                    <option value="island">Island</option>
                    <option value="shop">Shop</option>
                    <option value="office">Office</option>
                    <option value="jewelry">Jewelry</option>
                    <option value="living room">Living Room</option>
                    <option value="wedding dress">Wedding Dress</option>
                </select>
            </div>

            <div id="country-dropdown-container" class="country-dropdown-container">
                <label for="country-select" class="dropdown-label">Select Country:</label>
                <select id="country-select" class="entity-dropdown">
                    <option value="">-- Loading countries --</option>
                </select>
            </div>

            <div id="image-gallery-container" class="image-gallery-container">
                <div class="gallery-title" id="gallery-title"></div>
                <div class="loading-message" id="loading-message" style="display: none;">Loading images...</div>
                <div class="image-gallery" id="image-gallery"></div>
            </div>
        </div>
    </div>

    <script>
        // Store CSV data and current entity
        let csvData = null;
        let currentEntity = null;

        // CSV parser that handles quoted fields
        function parseCSVRow(row) {
            const values = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < row.length; i++) {
                const char = row[i];
                const nextChar = row[i + 1];
                
                if (char === '"') {
                    if (inQuotes && nextChar === '"') {
                        // Escaped quote
                        current += '"';
                        i++; // Skip next quote
                    } else {
                        // Toggle quote state
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    // Field separator
                    values.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            values.push(current.trim()); // Add last field
            return values;
        }

        // Parse full CSV and return both countries and full data
        function parseFullCSV(text) {
            const lines = text.trim().split('\n');
            if (lines.length < 2) return { countries: [], data: [] };
            
            // Get header row
            const headers = parseCSVRow(lines[0]);
            const countryColIndex = headers.indexOf('gemini-flash_faiss_country');
            const idColIndex = headers.indexOf('id');
            
            if (countryColIndex === -1 || idColIndex === -1) {
                return { countries: [], data: [] };
            }
            
            // Extract countries and full data
            const countries = new Set();
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = parseCSVRow(lines[i]);
                if (values.length > Math.max(countryColIndex, idColIndex)) {
                    const country = values[countryColIndex] ? values[countryColIndex].trim() : '';
                    const id = values[idColIndex] ? values[idColIndex].trim() : '';
                    
                    if (country && country !== 'NULL' && country !== '' && country.toLowerCase() !== 'null') {
                        countries.add(country);
                        data.push({ id, country });
                    }
                }
            }
            
            return {
                countries: Array.from(countries).sort(),
                data: data
            };
        }

        // Load CSV and populate country dropdown
        async function loadCountriesForEntity(entity) {
            const countrySelect = document.getElementById('country-select');
            const countryContainer = document.getElementById('country-dropdown-container');
            const galleryContainer = document.getElementById('image-gallery-container');
            
            // Hide gallery when entity changes
            galleryContainer.classList.remove('show');
            
            if (!entity) {
                countryContainer.classList.remove('show');
                csvData = null;
                currentEntity = null;
                return;
            }
            
            currentEntity = entity;
            
            // Show loading state
            countryContainer.classList.add('show');
            countrySelect.innerHTML = '<option value="">-- Loading countries --</option>';
            
            try {
                // Construct CSV filename (handle spaces in entity names)
                const csvFilename = `${entity}_sampled.csv`;
                
                // Fetch the CSV file
                const response = await fetch(csvFilename);
                if (!response.ok) {
                    throw new Error(`Failed to load CSV: ${response.statusText}`);
                }
                
                const csvText = await response.text();
                const parsed = parseFullCSV(csvText);
                csvData = parsed.data;
                
                // Populate dropdown
                countrySelect.innerHTML = '<option value="">-- Select a country --</option>';
                parsed.countries.forEach(country => {
                    const option = document.createElement('option');
                    option.value = country;
                    option.textContent = country.charAt(0).toUpperCase() + country.slice(1);
                    countrySelect.appendChild(option);
                });
                
            } catch (error) {
                console.error('Error loading countries:', error);
                countrySelect.innerHTML = '<option value="">-- Error loading countries --</option>';
            }
        }

        // Display images for selected country
        function displayImagesForCountry(country) {
            const galleryContainer = document.getElementById('image-gallery-container');
            const gallery = document.getElementById('image-gallery');
            const galleryTitle = document.getElementById('gallery-title');
            const loadingMessage = document.getElementById('loading-message');
            
            if (!country || !csvData || !currentEntity) {
                galleryContainer.classList.remove('show');
                return;
            }
            
            // Filter data by country
            const countryData = csvData.filter(row => 
                row.country && row.country.trim().toLowerCase() === country.toLowerCase()
            );
            
            if (countryData.length === 0) {
                galleryContainer.classList.remove('show');
                return;
            }
            
            // Show gallery
            galleryContainer.classList.add('show');
            loadingMessage.style.display = 'block';
            gallery.innerHTML = '';
            galleryTitle.textContent = `${country.charAt(0).toUpperCase() + country.slice(1)} - ${currentEntity.charAt(0).toUpperCase() + currentEntity.slice(1)} (${countryData.length} images)`;
            
            // Construct image path (encode spaces for URL)
            const imageBasePath = `${currentEntity}_images`.replace(/\s+/g, '%20');
            
            // Create image elements
            let loadedCount = 0;
            const totalImages = countryData.length;
            
            countryData.forEach((row, index) => {
                const imageItem = document.createElement('div');
                imageItem.className = 'image-item';
                
                const img = document.createElement('img');
                const imagePath = `${imageBasePath}/${row.id}.jpg`;
                img.src = imagePath;
                img.alt = `Image ${row.id}`;
                img.loading = 'lazy';
                
                // Handle image load/error
                img.onload = function() {
                    loadedCount++;
                    if (loadedCount === totalImages) {
                        loadingMessage.style.display = 'none';
                    }
                };
                
                img.onerror = function() {
                    // Hide broken images
                    imageItem.style.display = 'none';
                    loadedCount++;
                    if (loadedCount === totalImages) {
                        loadingMessage.style.display = 'none';
                    }
                };
                
                imageItem.appendChild(img);
                gallery.appendChild(imageItem);
            });
            
            // Hide loading if no images to load
            if (totalImages === 0) {
                loadingMessage.style.display = 'none';
            }
        }

        // Event listener for entity selection
        document.getElementById('entity-select').addEventListener('change', function(e) {
            const selectedEntity = e.target.value;
            loadCountriesForEntity(selectedEntity);
        });

        // Event listener for country selection
        document.getElementById('country-select').addEventListener('change', function(e) {
            const selectedCountry = e.target.value;
            displayImagesForCountry(selectedCountry);
        });
    </script>
</body>
</html>
